{{ extend SEARCHING_GRID }}

{{ block js }}
    {{ import simplejson  }}
    {{ from gluon.serializers import custom_json  }}
    <script type="text/javascript">

        var {{=cid}}__w2grid_options = {
                    url: "{{ =URL(request.controller, grid_function+'.json', vars={'_grid':True, 'data_name':data_name}, user_signature=True) }}",
                    columns: {{=XML(simplejson.dumps(w2ui_columns, default=custom_json, indent=4)) }},

                    sortData: {{=XML(simplejson.dumps(w2ui_sort,  default=custom_json, indent=4)) }},
            
            {{ block w2ui_grid_actions }} 

                    show: {
                        {{ if auth.has_permission('add', data_name ): }}
                            toolbarAdd: true,
                        {{ pass }}
                        {{ if auth.has_permission('edit',  data_name): }}
                            toolbarEdit: true,
                        {{ pass }}
                        {{ if auth.has_permission('delete', data_name): }}
                            toolbarDelete: true,
                        {{ pass }}
                    },
                    
                    onAdd: function(event){
                        // addUser();
                        //ajaxForm_popup(popup_name, title, form_name, url, data, options)
                        {{ context_name = data_name or table_name or cid }}
                        ajaxForm_popup(  
                                      "{{ =data_name }}", 
                                      "{{ =T( context_name +'__add_form' ) }}",
                                      "add_{{ =data_name }}",
                                      "{{ =URL(request.controller, 'add_' + data_name) }}"
                                       );
                        
                    },
                    onEdit: function(event){
                        var url = URL({'c': '{{=request.controller}}', 'f': 'edit_'+'{{=data_name}}' , 'args[]': [event.recid]});
                        if (event.newWindow){
                            openTab(url);
                        } else {
                            document.location = url;
                        }
                        //, function editTransferGood(rid){
                            // ajaxForm_popup("good", "{{ =T('warehouse_transfer_good__edit_form') }}", "edit_good",
                                           // URL({c: "warehouse", f: "edit_transfer_good", "args[]": [rid], user_signature: true}));
                        // }                
                    },
                    
            {{ end }}
            
        };

    $(function() {
        w2ui__grid('{{=cid}}');
    });

    {{ block w2ui_js_extra }}
    //  w2ui extra JS
    {{ end }}
    </script>

{{ end }}


{{ block after_grid }} 
{{if request.env.http_host.startswith('localhost'):
    =response.toolbar()
pass}}
{{ end }}
